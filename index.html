<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Reels Player</title>
  <link rel="icon" href="https://marya-hosting.pages.dev/btfstorage/file/idmha4pww8ow0y0f.jpg" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    :root {
      --purple: #8B5CF6;
      --red: #EF4444;
      --white: #FFFFFF;
      --dark: #000000;
    }
    html, body {
      margin: 0; padding: 0; height: 100%;
      background: var(--dark);
      color: var(--white);
      font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;
      overflow: hidden;
    }
    #intro-overlay {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      background: var(--dark);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.6s;
    }
    #intro-overlay.hidden {
      opacity: 0; visibility: hidden; pointer-events: none;
    }
    #intro-video {
      width: min(450px, 88vw); height: min(800px, 60vh);
      max-width: 94vw; max-height: 92vh;
      border-radius: 24px; background: #111;
      box-shadow: 0 8px 60px #8B5CF6cc;
      display: block;
    }
    #skip-intro {
      position: absolute; bottom: 9vw; right: 8vw;
      background: var(--purple);
      border: none; color: #fff; font-weight: 700; font-size: 1.1rem;
      padding: 10px 26px; border-radius: 20px; cursor: pointer;
      transition: background 0.2s;
    }
    #skip-intro:hover { background: #7222df; }

    #reels-container {
      position: relative; width: 100vw; height: 100vh;
      background: var(--dark);
      overflow: hidden;
    }
    .video-container {
      width: 100vw; height: 100vh; position: absolute; left: 0; top: 0;
      display: flex; align-items: center; justify-content: center;
      background: var(--dark);
    }
    video.reel-video {
      width: 100vw; height: 100vh; object-fit: cover;
      background: var(--dark); z-index: 1;
    }

    /* TopBar */
    .top-bar {
      position: fixed; top: 0; left: 0; width: 100vw;
      height: 62px;
      z-index: 100;
      background: linear-gradient(180deg,rgba(0,0,0,.7) 0%,transparent 100%);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 18px;
      pointer-events: none;
    }
    .top-bar .left, .top-bar .right {display:flex; align-items:center;}
    .top-bar .right { pointer-events: auto;}
    .app-logo {
      width: 38px; height: 38px;
      border-radius: 8px; margin-right: 10px;
      object-fit: cover; box-shadow: 0 2px 6px #0005;
      border:2px solid var(--purple);
    }
    .brand-title {
      font-size: 22px; font-weight: 800;
      background: linear-gradient(135deg,var(--purple),var(--red));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .search-btn {
      background: rgba(255,255,255,0.08); border-radius: 50%;
      border: none; outline: none; width: 42px; height: 42px; 
      color: #fff; text-align: center; font-size: 22px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: background 0.22s;
    }
    .search-btn:hover { background: var(--purple); }

    /* UserProfile bottom left */
    .user-info {
      position: fixed; left: 16px; bottom: 85px; right: 16px;
      z-index: 10;
      color: var(--white);
      background: none;
    }
    .user-header {
      display:flex; align-items:center; gap:9px;
      margin-bottom: 6px;
    }
    .profile-pic {
      width: 43px; height: 43px; object-fit: cover;
      border-radius: 50%; border:2px solid #fff; box-shadow: 0 0 9px #0008;
      cursor: pointer;
    }
    .username-container {
      display: flex; align-items: center; gap: 7px; cursor:pointer;
    }
    .username {
      font-size: 15px; font-weight: 700;
      color:var(--white); text-shadow:0 2px 9px #222B;
    }
    .verify-icon {
      font-size: 15px; color: var(--purple);
      margin-left: 2px;
    }
    .video-title {
      font-size: 14px; color: #efefef;
      font-weight: 500;
      padding-top: 1px;
      text-shadow:0 1px 5px #201a30bb;
      display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
      cursor:pointer; user-select:text;
    }

    .progress-bar {
      position: fixed; bottom: 0; left: 0; width: 100vw; height: 4px;
      background: rgba(255,255,255,.18); z-index: 90;
    }
    .progress-fill {
      height: 100%; width: 0;
      background: linear-gradient(90deg,var(--purple),var(--red));
      transition: width 0.1s linear;
    }

    .search-modal {
      position:fixed; top:0; left:0; right:0; bottom:0;
      background:rgba(0,0,0,0.95); z-index:202;
      display: none; align-items:center; justify-content:center;
      animation: fadeIn 0.3s ease;
    }
    .search-modal.active { display:flex; }
    @keyframes fadeIn{0%{opacity:0}100%{opacity:1}}
    .search-content {
      background:rgba(30,30,30,.93); border-radius:16px;
      width:92vw; max-width: 360px; padding: 30px 18px;
      box-shadow:0 12px 60px #1236;
    }
    .search-header{
      display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;
    }
    .search-title{
      font-weight:800;font-size:18px;color:var(--white);
    }
    .close-btn{
      border:none;background:transparent;color:var(--white);cursor:pointer;font-size:22px;border-radius:50%;width:33px;height:33px;display:flex;align-items:center;justify-content:center;
    }
    .close-btn:hover{background:rgba(255,255,255,.09);}
    .search-input{
      width:100%;font-size:16px;padding:13px 17px;background:rgba(255,255,255,0.08);
      color:var(--white);border-radius:10px;border:2px solid rgba(255,255,255,.16);margin-bottom:13px;outline:none;}
    .search-submit{
      width:100%;padding:13px;font-weight:700;border:none;
      background:linear-gradient(135deg,var(--purple),var(--red));
      border-radius:10px;color:var(--white);cursor:pointer;
    }
    .search-submit:hover{background:var(--purple);}
    .notification{
      position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
      background:rgba(0, 0, 0, 0.91);color:var(--white);
      padding:12px 24px;border-radius:17px;font-size:14px;z-index:480;opacity:0;transition:opacity 0.3s;
    }
    .notification.show{opacity:1;}
  </style>
</head>
<body oncontextmenu="return false;">
  <!-- Intro video overlay -->
  <div id="intro-overlay">
    <video id="intro-video" src="https://marya-hosting.pages.dev/btfstorage/file/idmhbvy5w7efdjbh.mp4" controls playsinline autoplay muted></video>
    <button id="skip-intro" onclick="skipIntro()">Skip</button>
  </div>

  <div id="reels-container"></div>
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="left">
      <img src="https://marya-hosting.pages.dev/btfstorage/file/idmha4pww8ow0y0f.jpg" class="app-logo"/>
      <span class="brand-title">Reels</span>
    </div>
    <div class="right">
      <button class="search-btn" onclick="openSearch()"><i class="fas fa-search"></i></button>
    </div>
  </div>
  <!-- User -->
  <div class="user-info">
    <div class="user-header">
      <img class="profile-pic" id="profilePic" src="">
      <div class="username-container" id="usernameContainer">
        <span class="username" id="username">Loading...</span>
        <i class="fas fa-certificate verify-icon" id="verifyIcon" title="Verified" style="display:none"></i>
      </div>
    </div>
    <div class="video-title" id="videoTitle">Loading...</div>
  </div>
  <!-- Progress Bar -->
  <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>

  <!-- Search Modal -->
  <div class="search-modal" id="searchModal">
    <div class="search-content">
      <div class="search-header">
        <div class="search-title">Search Reel</div>
        <button class="close-btn" onclick="closeSearch()"><i class="fas fa-times"></i></button>
      </div>
      <input type="text" class="search-input" id="searchInput" placeholder="Enter Reel ID" onkeypress="if(event.key==='Enter')searchReel()">
      <button class="search-submit" onclick="searchReel()">Search</button>
    </div>
  </div>
  <div class="notification" id="notification"></div>
  <script>
    let allReels=[], allProfiles=[], currentIndex=0, currentVideo=null, isTransitioning=false, touchStartY=0, lastTap=0, isAudioEnabled=localStorage.getItem('audioEnabled')==='true';

    // DOM
    const reelsContainer=document.getElementById('reels-container');
    const introOverlay=document.getElementById('intro-overlay');
    const introVideo=document.getElementById('intro-video');
    const profilePic=document.getElementById('profilePic');
    const username=document.getElementById('username');
    const usernameContainer=document.getElementById('usernameContainer');
    const verifyIcon=document.getElementById('verifyIcon');
    const videoTitle=document.getElementById('videoTitle');
    const progressFill=document.getElementById('progressFill');
    const searchModal=document.getElementById('searchModal');
    const searchInput=document.getElementById('searchInput');
    const notification=document.getElementById('notification');

    // --- Intro ---
    function skipIntro() {
      introVideo.pause();
      introOverlay.classList.add('hidden');
      setTimeout(() => introOverlay.style.display='none', 520);
    }
    introVideo.addEventListener('ended',skipIntro);

    // --- Notification ---
    function showNotification(msg) {
      notification.textContent=msg;
      notification.classList.add('show');
      setTimeout(()=>notification.classList.remove('show'),2000);
    }

    // --- Search ---
    function openSearch() {
      searchModal.classList.add('active'); searchInput.focus();
    }
    function closeSearch() {
      searchModal.classList.remove('active'); searchInput.value='';
    }
    function searchReel() {
      const reelId=searchInput.value.trim();
      if(!reelId){showNotification('Enter Reel ID');return;}
      const idx=allReels.findIndex(r=>r.reelId===reelId);
      if(idx!==-1){ currentIndex=idx;loadReel(currentIndex);closeSearch();showNotification('Reel loaded'); }
      else showNotification('Reel not found');
    }

    // --- Data ---
    async function loadMetadata() {
      try {
        // reels.json
        const reelsRes = await fetch("https://raw.githubusercontent.com/ydvkrn/Instagram/refs/heads/main/reels.json");
        const reelsData = await reelsRes.json();
        allReels = reelsData.reels || [];
        // profiles.json
        const profRes = await fetch("https://raw.githubusercontent.com/ydvkrn/Instagram/refs/heads/main/profiles.json");
        const profData = await profRes.json();
        allProfiles = profData.profiles || [];
      } catch {
        showNotification('Failed to load reels');
      }
    }
    function getProfile(userId) {
      const p=allProfiles.find(p=>p.id==userId);
      return p || { username:'User',profile:'https://i.postimg.cc/3Rh3SjRb/image.jpg',verified:false };
    }

    // --- UI update ---
    function updateUI(reel) {
      const profile = getProfile(reel.id);
      profilePic.src = profile.profile;
      username.textContent = profile.username;
      verifyIcon.style.display = profile.verified ? "inline" : "none";
      videoTitle.textContent = reel.title;
      profilePic.dataset.userId = reel.id;
      usernameContainer.dataset.userId = reel.id;
    }
    // --- Video logic ---
    function createVideoElement(reel) {
      const div=document.createElement('div'); div.className='video-container';
      const video=document.createElement('video');
      video.src=reel.media;
      video.className='reel-video';
      video.autoplay=true; video.loop=true; video.playsInline=true; video.muted=!isAudioEnabled;
      video.setAttribute('playsinline',''); video.setAttribute('webkit-playsinline','');
      video.addEventListener('canplay',()=>{ currentVideo=video; updateUI(reel); video.play().catch(()=>{}); });
      video.addEventListener('timeupdate',()=>{
        if(video.duration)progressFill.style.width=`${(video.currentTime/video.duration)*100}%`;
      });
      video.addEventListener('error',()=>{
        showNotification('Failed to load reel');
        setTimeout(()=>nextReel(),1000);
      });
      video.addEventListener('click',()=>{
        if(!isAudioEnabled){video.muted=false;isAudioEnabled=true;localStorage.setItem('audioEnabled','true');showNotification('Sound on');}
      });
      div.appendChild(video); return div;
    }
    function loadReel(index) {
      if(index<0||index>=allReels.length)return;
      if(currentVideo)currentVideo.pause();
      reelsContainer.innerHTML=''; progressFill.style.width='0%';
      const reel=allReels[index]; const videoDiv=createVideoElement(reel); reelsContainer.appendChild(videoDiv);
      history.replaceState({},'',`?reelId=${reel.reelId}`);
    }
    function nextReel() {
      if(isTransitioning)return; isTransitioning=true;
      currentIndex = (currentIndex+1)%allReels.length;
      loadReel(currentIndex); setTimeout(()=>isTransitioning=false,180);
    }
    function prevReel() {
      if(isTransitioning)return; isTransitioning=true;
      currentIndex = (currentIndex-1+allReels.length)%allReels.length;
      loadReel(currentIndex); setTimeout(()=>isTransitioning=false,180);
    }

    // Like Animation (optional: uncomment these lines if you like)
    // function showLike(x,y){
    //   const img=document.createElement('img');
    //   img.src='https://i.postimg.cc/pr68HrJm/1000063176-removebg-preview.png';
    //   img.className='like-animation';img.style.left=x+'px';img.style.top=y+'px';
    //   reelsContainer.appendChild(img);setTimeout(()=>img.remove(),600);
    // }

    // --- Touch/swipe logic ---
    reelsContainer.addEventListener('touchstart',e=>{ touchStartY=e.touches[0].clientY; });
    reelsContainer.addEventListener('touchend',e=>{
      const dy = touchStartY-e.changedTouches[0].clientY;
      const now=Date.now();
      // Uncomment for double tap like
      // if(now-lastTap<350){showLike(e.changedTouches[0].clientX,e.changedTouches[0].clientY);lastTap=0;return;}
      lastTap=now;
      if(Math.abs(dy)>48){ (dy>0?nextReel():prevReel()); }
    });

    // Progress bar seek
    document.querySelector('.progress-bar').addEventListener('click',e=>{
      if(currentVideo&&currentVideo.duration){
        const rect=e.target.getBoundingClientRect();
        const percent=(e.clientX-rect.left)/rect.width;
        currentVideo.currentTime=percent*currentVideo.duration;
      }
    });

    // Keyboard
    document.addEventListener('keydown',e=>{
      if(e.key==='ArrowUp'){e.preventDefault();nextReel();}
      if(e.key==='ArrowDown'){e.preventDefault();prevReel();}
      if(e.key===' '){
        if(currentVideo)currentVideo.paused?currentVideo.play():currentVideo.pause();
      }
      if(e.key==='/'){openSearch();}
      if(e.key==='Escape'){closeSearch();}
    });

    // Profile click
    profilePic.addEventListener('click',()=>{
      const userId=profilePic.dataset.userId;
      if(userId)window.open(`/profiles.html?id=${userId}`,'_blank');
    });
    usernameContainer.addEventListener('click',()=>{
      const userId=usernameContainer.dataset.userId;
      if(userId)window.open(`/profiles.html?id=${userId}`,'_blank');
    });

    // ---- INIT ----
    async function startApp(){
      await loadMetadata();
      // URL param for reel
      const urlParams=new URLSearchParams(window.location.search);
      const reelId=urlParams.get('reelId');
      if(reelId){ const idx=allReels.findIndex(r=>r.reelId===reelId);
        if(idx!==-1)currentIndex=idx;
      }
      loadReel(currentIndex);
    }

    introVideo.addEventListener('ended',()=>setTimeout(startApp,290));
    window.skipIntro=function(){skipIntro();setTimeout(startApp,350);}
    // If autoplay fails/blocked, show skip always
    introVideo.addEventListener('play',()=>{});
    introVideo.addEventListener('pause',()=>{});

    // Only start reels after intro
    // No autoplay on mobile? Fallback after 4s if intro stuck
    setTimeout(()=>{
      if(!introOverlay.classList.contains('hidden') && introVideo.currentTime<0.2){
        skipIntro();setTimeout(startApp,100);
      }
    },4500);

    // Disable context menu
    document.addEventListener('contextmenu',e=>e.preventDefault());
  </script>
</body>
</html>
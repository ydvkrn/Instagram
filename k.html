<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Reel Of The Day</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: #000;
            overflow: hidden;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        #reels-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            scroll-snap-type: y mandatory;
            -webkit-overflow-scrolling: touch;
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 100vh;
            scroll-snap-align: start;
            flex-shrink: 0;
            background-color: #000;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            background-color: #000;
        }

        .fixed-overlay {
            position: fixed;
            bottom: 80px;
            left: 15px;
            width: calc(100% - 30px);
            display: flex;
            align-items: center;
            padding: 10px;
            background: transparent;
        }

        .profile-pic {
            width: 45px;
            height: 45px;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid white;
        }

        .user-info {
            margin-left: 10px;
            color: white;
        }

        .username {
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .verify-badge {
            width: 16px;
            height: 16px;
            margin-left: 5px;
        }

        .title {
            font-size: 14px;
            opacity: 0.9;
            position: fixed;
            bottom: 40px;
            left: 15px;
            width: calc(100% - 30px);
            color: white;
            padding: 5px 10px;
            background: transparent;
            border-radius: 8px;
            white-space: normal;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="reels-container"></div>
    
    <div class="fixed-overlay">
        <img class="profile-pic" id="profile-pic" src="">
        <div class="user-info">
            <div class="username" id="username">
                <span id="username-text">Loading...</span>
                <img class="verify-badge" id="verify-badge" src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/81/Twitter_Verified_Badge_Gold.svg/2048px-Twitter_Verified_Badge_Gold.svg.png">
            </div>
        </div>
    </div>
    
    <div class="title" id="title" onclick="showFullTitle()">Loading...</div>

    <script>
        let fullTitle = "";
        let currentReels = [
            { "reelId": "reel1", "title": "Funny Cat Video", "media": "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4", "id": "user1" },
            { "reelId": "reel2", "title": "Dance Video", "media": "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_2mb.mp4", "id": "user2" }
        ];
        const profiles = [
            { "id": "user1", "username": "user1", "profile": "https://via.placeholder.com/45", "verified": true },
            { "id": "user2", "username": "user2", "profile": "https://via.placeholder.com/45", "verified": false }
        ];
        let currentBatchStart = 0;

        // URL se reelId extract karna
        const urlParams = new URLSearchParams(window.location.search);
        const initialReelId = urlParams.get('reelId') || "reel1"; // Default reel1

        // URL mein reelId ke hisaab se initial batch set karna
        if (initialReelId) {
            const initialReelIndex = currentReels.findIndex(reel => reel.reelId === initialReelId);
            if (initialReelIndex !== -1) {
                currentBatchStart = initialReelIndex;
            }
        }

        const container = document.getElementById('reels-container');
        const profilePic = document.getElementById('profile-pic');
        const usernameText = document.getElementById('username-text');
        const verifyBadge = document.getElementById('verify-badge');
        const title = document.getElementById('title');

        function getProfileById(id) {
            return profiles.find(profile => profile.id === id) || { 
                username: "bot", 
                profile: "https://via.placeholder.com/45", 
                verified: true
            };
        }

        function createVideoElement(reel, index) {
            const div = document.createElement('div');
            div.className = 'video-container';

            const video = document.createElement('video');
            video.playsInline = true;
            video.controls = false;
            video.muted = false;
            video.loop = true;
            video.dataset.index = index;
            video.dataset.title = reel.title;
            video.src = reel.media;

            div.appendChild(video);
            return div;
        }

        function loadVideos() {
            container.innerHTML = '';
            currentReels.forEach((reel, index) => {
                const videoElement = createVideoElement(reel, index);
                container.appendChild(videoElement);
            });
            enableScrollPlayback();
        }

        function updateMetadata(reel) {
            fullTitle = reel.title;
            title.innerText = reel.title;
            const profileData = getProfileById(reel.id);
            profilePic.src = profileData.profile;
            usernameText.innerText = profileData.username;
            verifyBadge.style.display = profileData.verified ? "inline" : "none";
        }

        function enableScrollPlayback() {
            let currentVideo = null;
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const video = entry.target;
                    const index = parseInt(video.dataset.index);

                    if (entry.isIntersecting) {
                        if (currentVideo && currentVideo !== video) {
                            currentVideo.pause();
                        }
                        currentVideo = video;

                        video.play().catch(error => console.log("Play error:", error));

                        const reel = currentReels[index];
                        if (reel) {
                            updateMetadata(reel);
                            window.history.pushState({}, document.title, `/Instagram/?reelId=${reel.reelId}`);
                        }
                    } else if (video !== currentVideo) {
                        video.pause();
                    }
                });
            }, { threshold: 0.7 });

            const videos = document.querySelectorAll("video");
            videos.forEach(video => observer.observe(video));
        }

        function showFullTitle() {
            alert(fullTitle);
        }

        // Initial load
        loadVideos();
    </script>
</body>
</html>
